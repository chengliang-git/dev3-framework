server:
  port: 8080
  servlet:
    context-path: /api
    encoding:
      charset: UTF-8
      enabled: true
      force: true

spring:
  application:
    name: guanwei-framework
  profiles:
    active: dev
  # 数据源配置（合并dev配置）
  datasource:
    url: jdbc:oracle:thin:@localhost:1521:XE
    username: ${ORACLE_USERNAME:framework}
    password: ${ORACLE_PASSWORD:framework123}
    driver-class-name: oracle.jdbc.OracleDriver
    hikari:
      pool-name: HikariCP
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1 FROM DUAL
  # Redis配置
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: 0
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  # RabbitMQ配置
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: /
    connection-timeout: 15000
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          max-attempts: 3
          initial-interval: 3000
  # Jackson配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: NON_NULL

# MyBatis Plus配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.guanwei.framework.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: ASSIGN_ID
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# JWT配置
jwt:
  secret: ${JWT_SECRET:guanwei-framework-jwt-secret-key-2024}
  expiration: 86400000 # 24小时
  header: Authorization
  prefix: Bearer

# Apollo配置中心
apollo:
  app-id: ${APOLLO_APP_ID:guanwei-framework}
  meta: ${APOLLO_META:http://localhost:8080}
  bootstrap:
    enabled: true
    eagerLoad:
      enabled: true
    namespaces: application,database,redis,rabbitmq
  timeout: 5000 # 5秒超时
  cache-dir: ${APOLLO_CACHE_DIR:./config-cache}

# Knife4j API文档配置
knife4j:
  enable: true
  setting:
    language: zh_cn
    enable-version: true
    enable-reload-cache-parameter: true
    enable-after-script: true
    enable-filter-multipart-api-method-type: POST
    enable-filter-multipart-apis: false
    enable-request-cache: true
    enable-host: false
    enable-host-text: http://localhost:8080
    enable-home-custom: true
    home-custom-location: classpath:markdown/home.md
  documents:
    - group: 企业框架API
      name: 企业级Spring Boot框架接口文档
      locations: classpath:markdown/*

# 日志配置
logging:
  level:
    com.guanwei.framework: debug
    org.springframework.security: debug
    com.ctrip.framework.apollo: warn
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: logs/guanwei-framework.log
    max-size: 10MB
    max-history: 30

# 框架自定义配置
framework:
  security:
    permit-all-paths:
      - /api/auth/login
      - /api/auth/register
      - /doc.html
      - /webjars/**
      - /swagger-resources/**
      - /v3/api-docs/**
      - /actuator/**
    cors:
      allowed-origins: "*"
      allowed-methods: "*"
      allowed-headers: "*"
      allow-credentials: true
  generator:
    author: GuanWei Framework
    package-name: com.guanwei.framework
    table-prefix: t_
    exclude-columns: id,create_time,update_time,deleted
  upload:
    path: ${UPLOAD_PATH:./uploads}
    max-file-size: 10MB
    max-request-size: 100MB
    allowed-extensions: jpg,jpeg,png,gif,bmp,pdf,doc,docx,xls,xlsx,ppt,pptx,txt,zip,rar
